# Docker

### 도커란?

컨테이너 기반의 오픈소스 가상화 플랫폼이다.

컨테이너는 프로세스를 격리시켜 동작하는 방식이다. 도커 엔진 위에 application 실행에 필요한 바이너리만 올라가게 된다. Host OS 위 도커엔진 그 위에서 바로 동작하며 Host의 커널을 공유한다. 즉 Host OS가 사용하는 자원을 분리하여 여러 환경을 만들 수 있도록 하는 것이다.

일반 가상머신은 운영체제 위에 운영체제를 올리는 것이기 때문에 비효율적이다. 

![스크린샷 2020-02-14 오후 9 21 47](https://user-images.githubusercontent.com/26567962/74531481-15450e00-4f70-11ea-85d5-ee2ce5aef1c7.png)



### 레이어 저장 방식

![image-layer](https://user-images.githubusercontent.com/26567962/74536317-3101e180-4f7b-11ea-8217-1f30185fe047.png)

도커 이미지는 컨테이너를 실행하기 위한 모든 정보를 가지고 있기 때문에 용랑이 매우 크다. 기존 이미지에 파일 하나 추가했다고 수백메가를 다시 다운 받는 것은 매우 비효율 적이다. 이런 문제를 해결하기 위해 **레이어** 라는 개념을 사용하고, 유니온 파일 시스템을 이용하여 여러개의 레이어를 하나의 파일 시스템으로 사용할 수 있게 해준다. 이미지는 여러개의 읽기 전용 레이어로 구성되고 파일이 추가되거나 수정되면 새로운 레이어가 생성된다.

컨테이너를 생성할 때도 기존의 이미지 레이어 위에 읽기/쓰기 레이어를 추가한다. 이미지 레이어를 그대로 사용하면서 컨테이너가 실행 중에 생성하는 파일이나 변경된 내용은 읽기/쓰기 레이어에 저장되므로 여러개의 컨테이너를 생성해도 최소한의 용량만 사용한다. 

containerd와 runc를 기반으로 동작한다. 도커는 기본적으로 서버, 클라이언트 아키텍처를 가지고 있으며 REST API로 조작할 수 있다. 



### 도커를 쓰는 이유

서버마다 운영 기록이 다르고, 컴파일러, 설치된 패키지까지 완벽하게 동일하기 어렵다. 이렇게 서버마다 상황이 다 다르고 모양이 다 다른 상황을 눈송이 서버라고 한다.

도커파일 - 서버 운영 기록을 코드화 한 것

도커 이미지 - 도커 파일에 실행할 시점을 더한 것. 실행에 필요한 파일과 설정 값들을 포함하고 있는 것

도커 컨테이너 - 도커 이미지에 실행 시점에 수정되어야 할 정보들을 더한 것 / 도커이미지 + 환경 변수

도커 파일로 이미지를 만들어 두면, 서버가 구성되는 시점이 이미지를 만든 시점으로 고정된다. 이미지를 실행시키는 시점이 언제든 같은 모양이다. 그렇기 떄문에 서버를 항상 똑같은 상태로 만들 수 있다.



### Docker Compose

도커 컨테이너들은 각각 격리된 환경에서 실행된다. 즉, 별도의 옵션을 지정하지 않으면 다른 컨테이너의 존재를 알 수 없다. 두개의 컨테이너를 연결하기 위해서는 실행 옵션으로 적어줘야 하는데 이게 매우 불편하다.

컨테이너 실행에 필요한 옵션을 적어둔 파일이고, 컨테이너 간 실행 순서나 의존성도 관리할 수 있다.

## 



#### Q. 도커란 무엇인가요?

컨테이너 기반의 오픈소스 가상화 플랫폼 입니다. 이전의 가상머신들은 운영체제 위에 운영체제를 올려서 비효율 적이었는데,  도커는 도커 엔진 위에 application 실행에 필요한 바이너리만 올리게 됩니다. 도커엔진 위에서 바로 동작하며 Host의 커널을 공유하면서 Host OS가 사용하는 자원을 분리하여 여러 환경을 만들 수 있도록 하는 것 입니다.



#### Q. 도커의 레이어 저장 방식을 설명해 주세요.

도커 이미지는 컨테이너를 실행하기 위한 모든 정보를 가지고 있기 때문에 용랑이 매우 큽니다. 이런 문제를 해결하기 위해 레이어라는 개념으로 나누고 유니온 파일 시스템을 사용하여 여러 개의 레이어를 하나의 파일 시스템으로 사용할 수 있게 해줍니다. 바뀌는 부분의 레이어만 다운 받으면 되기 때문에 효율적으로 이미지를 관리 할 수 있습니다.



#### Q. 도커를 사용하는 이유는 무엇인가요?

도커 파일로 이미지를 만들어 두면, 서버가 구성되는 시점이 이미지를 만든 시점으로 고정됩니다. 이미지를 실행시키는 시점이 언제든 같은 모양으로 만들어 집니다. 서버를 항상 똑같은 상태로 만들 수 있어서 사용합니다.



#### Q. 이미지와 컨테이너는 무엇인가요?

이미지는 컨테이너 실행에 필요한 파일과 설정값등을 포함하고 있는 것으로 상태값을 가지지 않고 변하지 않습니다(Immutable). 컨테이너는 이미지를 실행한 상태라고 볼 수 있고 추가되거나 변하는 값은 컨테이너에 저장됩니다.



#### Q 맥도 리눅스가 아닌데 맥에서 어떻게 리눅스 커널을 열게되나요?

도커 데스크탑은 리눅스킷 기반 경량 가상머신 위에서 도커를 실행하기 때문입니다.

